=========================================================================================
                           UPSERT IN PRISMA (A‚ÄìZ GUIDE)
=========================================================================================

=========================================================================================
# 0. Upsert ‡¶ï‡ßÄ?
=========================================================================================
Upsert ‡¶Æ‡¶æ‡¶®‡ßá ‡¶π‡¶≤‡ßã ‚Äî

üëâ **Update + Insert** ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá  
üëâ ‡¶Ø‡¶¶‡¶ø data ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá ‡¶•‡¶æ‡¶ï‡ßá ‚Üí UPDATE  
üëâ ‡¶Ø‡¶¶‡¶ø data ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá ‚Üí INSERT  

‡¶è‡¶ï ‡¶ï‡¶•‡¶æ‡ßü:
-----------------------------------------------------------------------------------------
"‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü, ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶á‡¶®‡¶∏‡¶æ‡¶∞‡ßç‡¶ü"
-----------------------------------------------------------------------------------------

=========================================================================================
# 1. Prisma ‡¶è Upsert ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞?
=========================================================================================
Upsert ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶π‡ßü ‡¶Ø‡¶ñ‡¶®:

‚úî Duplicate insert avoid ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶á  
‚úî Unique field ‡¶è‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø ‡¶ï‡¶∞‡ßá data sync ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶á  
‚úî One query ‡¶§‡ßá‡¶á logic handle ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶á  
‚úî Race condition ‡¶ï‡¶Æ‡¶æ‡¶§‡ßá ‡¶ö‡¶æ‡¶á  

üëâ Real-world backend ‡¶è ‡¶ñ‡ßÅ‡¶¨ common

=========================================================================================
# 2. Prisma Upsert Syntax
=========================================================================================
-----------------------------------------------------------------------------------------
await prisma.modelName.upsert({
  where: {
    uniqueField: value,
  },
  update: {
    field1: newValue,
  },
  create: {
    field1: value,
  },
});
-----------------------------------------------------------------------------------------

Rules:
‚úî where ‚Üí ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á UNIQUE field ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá  
‚úî update ‚Üí record ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ï‡¶ø ‡¶π‡¶¨‡ßá  
‚úî create ‚Üí record ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ï‡¶ø ‡¶π‡¶¨‡ßá  

=========================================================================================
# 3. Simple Upsert Example
=========================================================================================
User email ‡¶¶‡¶ø‡ßü‡ßá upsert:

-----------------------------------------------------------------------------------------
await prisma.user.upsert({
  where: {
    email: "ridoan@gmail.com",
  },
  update: {
    name: "Updated Ridoan",
  },
  create: {
    name: "Ridoan",
    email: "ridoan@gmail.com",
    password: "hashed_password",
  },
});
-----------------------------------------------------------------------------------------

Flow:
- email exist ‡¶ï‡¶∞‡¶≤‡ßá ‚Üí name update  
- email ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‚Üí new user create  

=========================================================================================
# 4. Upsert With Enum Field
=========================================================================================
-----------------------------------------------------------------------------------------
await prisma.user.upsert({
  where: {
    email: "admin@gmail.com",
  },
  update: {
    role: "ADMIN",
  },
  create: {
    name: "Admin",
    email: "admin@gmail.com",
    password: "admin_pass",
    role: "ADMIN",
  },
});
-----------------------------------------------------------------------------------------

üëâ Enum value strict & type-safe

=========================================================================================
# 5. Upsert With One-to-One Relation
=========================================================================================
User Profile upsert:

-----------------------------------------------------------------------------------------
await prisma.profile.upsert({
  where: {
    userId: 1, // UNIQUE field
  },
  update: {
    bio: "Updated bio",
  },
  create: {
    bio: "New bio",
    user: {
      connect: {
        id: 1,
      },
    },
  },
});
-----------------------------------------------------------------------------------------

üëâ Profile ‡¶•‡¶æ‡¶ï‡¶≤‡ßá update  
üëâ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá create + connect

=========================================================================================
# 6. Upsert With One-to-Many Relation
=========================================================================================
Post upsert (unique title per user):

-----------------------------------------------------------------------------------------
await prisma.post.upsert({
  where: {
    id: 10, // unique
  },
  update: {
    title: "Updated Title",
  },
  create: {
    title: "New Title",
    userId: 1,
  },
});
-----------------------------------------------------------------------------------------

=========================================================================================
# 7. Composite Unique Field ‡¶¶‡¶ø‡ßü‡ßá Upsert
=========================================================================================
schema.prisma ‡¶è:

-----------------------------------------------------------------------------------------
model Booking {
  id        Int @id @default(autoincrement())
  userId    Int
  vehicleId Int

  @@unique([userId, vehicleId])
}
-----------------------------------------------------------------------------------------

Upsert query:

-----------------------------------------------------------------------------------------
await prisma.booking.upsert({
  where: {
    userId_vehicleId: {
      userId: 1,
      vehicleId: 2,
    },
  },
  update: {
    status: "APPROVED",
  },
  create: {
    userId: 1,
    vehicleId: 2,
    status: "PENDING",
  },
});
-----------------------------------------------------------------------------------------

üëâ Composite unique powerful feature

=========================================================================================
# 8. Upsert vs create + update
=========================================================================================
Manual way:
-----------------------------------------------------------------------------------------
find ‚Üí if ‚Üí update/create
-----------------------------------------------------------------------------------------

Prisma upsert:
-----------------------------------------------------------------------------------------
upsert()
-----------------------------------------------------------------------------------------

‡¶´‡¶æ‡ßü‡¶¶‡¶æ:
‚úî One DB roundtrip  
‚úî Less race condition  
‚úî Clean code  

=========================================================================================
# 9. Common Mistakes
=========================================================================================
‚ùå where ‡¶è non-unique field ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞  
‚ùå update ‡¶¨‡¶æ create miss ‡¶ï‡¶∞‡¶æ  
‚ùå Composite unique ‡¶®‡¶æ‡¶Æ ‡¶≠‡ßÅ‡¶≤ ‡¶≤‡ßá‡¶ñ‡¶æ  
‚ùå Migration ‡¶®‡¶æ ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®‡ßã  

=========================================================================================
# 10. Best Practices
=========================================================================================
‚úî Always use unique field in where  
‚úî Enum + upsert = safe status update  
‚úî Sync logic ‡¶è upsert ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßã  
‚úî Schema change ‚Üí migrate dev  

=========================================================================================
# 11. Summary (Final Takeaway)
=========================================================================================
- Upsert = Update + Insert
- Unique field mandatory
- Single query solution
- Type-safe & race-safe
- Real-world backend essential
- Prisma upsert powerful & clean

=========================================================================================
                                   THE END
=========================================================================================
